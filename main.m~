%% Add Directory Tree to MATLAB Path

addpath(genpath('~/Repositories/WOGRSS'));
cd ~/Repositories/WOGRSS

%% Generate Input Parameter Object

run ./prm/californiaSample.m

%% Select Study Site

[hucID, hucIndex] = getHucCodeFnc( ...
    p.hucCodeShapeStruct, ...
    p.overlayShapeStruct);

%% Generate Grid Mask

[gridMask, gridMaskGeoRasterRef] = hucCode2GridMaskFnc( ...
    p.hucCodeShapeStruct, ...
    hucIndex, ...
    p.gridDensity);

%% Extract Source Index

sourceIndex = getSourceIndexFnc( ...
    gridMaskGeoRasterRef, ...
    gridMask);

%% Generate Raster Mosaic Cell Dataset

rasterMosaicData = extractRasterMosaicDataFnc( ...
    p.topLevelRasterDir, ...
    p.rasterNanFloor, ...
    gridMaskGeoRasterRef );

%% View Raster Mosaic Dataset

rasterMosaicDataPlot( ...
    rasterMosaicData, ...
    p.hucCodeShapeStruct, ...
    hucIndex, ...
    gridMaskGeoRasterRef );

%% Generate Vector Mosaic Cell Dataset

vectorMosaicData = extractVectorMosaicDataFnc( ...
    p.topLevelVectorDir, ...
    p.hucCodeShapeStruct, ...
    hucIndex, ...
    gridMaskGeoRasterRef );

%% View Vector Mosaic Dataset

vectorMosaicDataPlot( ...
    vectorMosaicData, ...
    gridMaskGeoRasterRef );

%% Rasterize Vector Mosaic Dataset

newRasterMosaicData = vector2RasterMosaicDataFnc( ...
    vectorMosaicData, ...
    p.attributeFieldCell, ...
    gridMask, ...
    gridMaskGeoRasterRef );

%% Combine Raster Mosaic Datasets

finalRasterMosaicData = vertcat( rasterMosaicData, newRasterMosaicData);

%% Visualize Combined Final Raster Mosaic Dataset

rasterMosaicDataPlot( ...
    finalRasterMosaicData, ...
    p.hucCodeShapeStruct, ...
    hucIndex, ...
    gridMaskGeoRasterRef );
